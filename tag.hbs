{{!< default}}

<div class="split-content-wrapper">
<!-- DEBUG: TAG.HBS IS RENDERING -->
	<div class="main-content-area">

		{{!-- Tag Archive Header --}}
		<header class="archive-header">
			<ul class="breadcrumb-list">
				<li class="breadcrumb-item home">
					{{> "icons/map-pin"}}
					<a class="title" href="{{@site.url}}">Home</a>
				</li>
				<li class="breadcrumb-separator">{{> "icons/chevron"}}</li>
				<li class="breadcrumb-item">Topics</li>
				<li class="breadcrumb-separator">{{> "icons/chevron"}}</li>
				{{#tag}}
					<li class="breadcrumb-item current">{{name}}</li>
				{{/tag}}
			</ul>

			{{#tag}}
			<div class="archive-title-wrapper">
			<div class="featured-topic-img">
				{{#if feature_image}}
				<figure>
					<picture>
						<source
							srcset="
								{{img_url feature_image size="s" format="avif"}} 270w,
								{{img_url feature_image size="m" format="avif"}} 400w
							"
							sizes="(min-width: 400px) 400px, 100vw"
							type="image/avif">
						<source
							srcset="
								{{img_url feature_image size="s" format="webp"}} 270w,
								{{img_url feature_image size="m" format="webp"}} 400w
							"
							sizes="(min-width: 400px) 400px, 100vw"
							type="image/webp">
						<img
							srcset="
								{{img_url feature_image size="s"}} 270w,
								{{img_url feature_image size="m"}} 400w
							"
							sizes="(min-width: 400px) 400px, 100vw"
							src="{{img_url feature_image size="m"}}"
							alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}"
							loading="lazy"
							width="160"
							height="160">
					</picture>
				</figure>
				{{else}}
				<img class="flex-shrink-0 mx-auto" src="{{asset 'img/dudeinlab.avif'}}" width="160" height="160" alt="Arrow pointing down">
				{{/if}}
			</div>
			<div>
				<h2 class="archive-title">{{name}} Archive</h2>
				{{#if description}}
					<p class="archive-description">{{description}}</p>
				{{/if}}
				<p class="archive-count">{{plural count.posts empty='No posts' singular='% post' plural='% posts'}}</p>
			</div>
			</div>
			{{/tag}}
		</header>

		{{!-- Masonry Grid Section - OUTSIDE the #tag block! --}}
		<section class="featured-masonry-section">
			<div class="masonry-grid">
				{{#foreach posts}}
					<article class="masonry-card" data-tags="{{#foreach tags}}{{slug}} {{/foreach}}">
						{{#if feature_image}}
							<div class="masonry-image">
								<img
									srcset="{{img_url feature_image size='s' format='webp'}} 400w,
											{{img_url feature_image size='m' format='webp'}} 800w"
									sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 400px"
									src="{{img_url feature_image size='m' format='webp'}}"
									alt="{{title}}"
									width="800"
									height="600"
									loading="lazy">
							</div>
						{{/if}}
						<div class="masonry-content">
							<h3 class="masonry-title">
								<a href="{{url}}">{{title}}</a>
							</h3>
							<div class="masonry-excerpt">{{excerpt words="25"}}</div>
							<div class="masonry-meta">
								{{#primary_author}}
									<a class="avatar wiggle" href="{{url}}">
										<img
											srcset="{{img_url profile_image size='xxs' format='webp'}} 50w,
													{{img_url profile_image size='xs' format='webp'}} 100w"
											sizes="50vw"
											src="{{img_url profile_image size='xs' format='webp'}}"
											alt="{{name}}'s Avatar"
											width="40"
											height="40"
											loading="lazy" />
									</a>
								{{/primary_author}}
								&middot;
								<time datetime="{{date published_at format='YYYY-MM-DD'}}">
									{{date published_at timeago="true"}}
								</time>
								{{#if primary_tag}}
									&middot; <span class="masonry-tag">{{primary_tag.name}}</span>
								{{/if}}
							</div>
						</div>
						<a href="{{url}}" class="masonry-link" aria-label="Read {{title}}"></a>
					</article>
				{{/foreach}}
			</div>
			{{!-- Load More Button - MOVED OUTSIDE the masonry-grid --}}
			{{#if pagination.next}}
				<div class="load-more">
					<button id="load-more-btn" type="button" aria-label="Load more posts">
						Load More Posts
					</button>
				</div>
			{{/if}}

			{{!-- Pagination Data --}}
			{{#if pagination}}
				<script type="application/json" id="pagination-data">
				{
					"currentPage": {{pagination.page}},
					"totalPages": {{pagination.pages}},
					"hasNext": {{#if pagination.next}}true{{else}}false{{/if}},
					"hasPrev": {{#if pagination.prev}}true{{else}}false{{/if}},
					"total": {{pagination.total}},
					"limit": {{pagination.limit}}
				}
				</script>
			{{/if}}
		</section>
	</div>

	<aside class="content-aside">
		{{> "layout/aside-content"}}
	</aside>
</div>