<!DOCTYPE html>
<html lang="{{@site.locale}}">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{meta_title}}</title>
	{{! Ghost outputs meta description automatically in ghost_head }}

	{{! Ghost head for SEO, analytics, etc }}
	{{ghost_head}}

	{{! Theme styles }}
	<link rel="stylesheet" type="text/css" href="{{asset "built/screen.css"}}">
	<link rel="preload" href="https://use.typekit.net/unt3hxg.css" as="style">
	<link rel="stylesheet" href="https://use.typekit.net/unt3hxg.css">
</head>
<body class="{{body_class}}">
	{{! Top Header }}
	<header class="top-header">
		<div class="header-content">
			<div class="header-left">
				<button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
				<a href="{{@site.url}}" class="logo">{{@site.title.[0]}}</a>
				<div class="search-bar">
					<input type="text" class="search-input" placeholder="Search {{@site.title}}">
					<span class="search-icon">ğŸ”</span>
				</div>
			</div>
			<div class="header-right">
				{{#unless @member}}
					<a href="#/portal/signin" class="header-btn" data-portal="signin">Sign in</a>
					<a href="#/portal/signup" class="header-btn primary" data-portal="signup">Subscribe</a>
				{{else}}
					<a href="#/portal/account" class="header-btn" data-portal="account">Account</a>
				{{/unless}}
			</div>
		</div>
	</header>

	<div class="layout">
		{{! Sidebar }}
		<aside class="sidebar">
			<nav>
				<h1>You <span>can't</span> be serious.</h1>
				<p class="tagline">An optimists guide to maintaining equanimity and sanity during an age of bullshit</p>
				<ul class="sidebar-nav">
					<li><a href="{{@site.url}}" class="sidebar-link {{#is "home"}}active{{/is}}">
						Home
					</a></li>
					<li><a href="{{@site.url}}/tag/poetry/" class="sidebar-link">
						Poetry
					</a></li>
					<li><a href="{{@site.url}}/tag/fiction/" class="sidebar-link">
						Fiction
					</a></li>
					<li><a href="{{@site.url}}/tag/art/" class="sidebar-link">
						Art & Cartoons
					</a></li>
					<li><a href="{{@site.url}}/archive/" class="sidebar-link">
						Archive
					</a></li>
					<li><a href="{{@site.url}}/about/" class="sidebar-link">
						About
					</a></li>
				</ul>
			</nav>

			{{! Now Reading Widget }}
			<div class="now-reading-widget">
				<div class="widget-header">
					<span class="widget-icon">ğŸ“–</span>
					<span class="widget-title">FEATURED</span>
				</div>

				{{#get "posts" filter="featured:true" limit="3" as |featured_posts|}}
				{{#foreach featured_posts}}
				<div class="widget-content">
					<div class="widget-cover">
						{{#if feature_image}}
						<img src="{{img_url feature_image size="s"}}" alt="{{title}}" class="cover-image">
						{{else}}
						<div class="cover-image" style="background: linear-gradient(45deg, #ff6719 0%, #ff9f43 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">{{title.[0]}}</div>
						{{/if}}
					</div>

					<div class="widget-info">
						<div class="widget-post-title">{{title}}poop</div>
						<div class="widget-author">by {{primary_author.name}}</div>
					</div>
				</div>
				{{/foreach}}
				{{/get}}

				<div class="widget-controls">
					<a href="{{@site.url}}/rss/" class="widget-btn" title="RSS Feed">ğŸ“¡</a>
					<a href="#/portal/" class="widget-btn" title="Subscribe" data-portal="signup">ğŸ“§</a>
					<a href="{{@site.url}}/archive/" class="widget-btn" title="Archive">ğŸ“š</a>
				</div>

				<div class="widget-footer">
					<span class="copyright">Â© {{date format="YYYY"}}</span>
				</div>
			</div>
		</aside>

		{{! Sidebar Overlay for Mobile }}
		<div class="sidebar-overlay" onclick="toggleSidebar()"></div>

		{{! Main Content }}
		<main class="main-content">
			{{{body}}}
		</main>
	</div>

	{{! Ghost foot for member portal, analytics, etc }}
	{{ghost_foot}}

	{{! Theme JavaScript }}
	<script src="{{asset "built/script.js"}}"></script>
	{{!-- Add this to default.hbs right before </body> tag --}}
	{{!-- Development auto-refresh for HBS files --}}
	<script>
		// Only run in development (when localhost)
		if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
			console.log('ğŸ”„ Development mode: Auto-refresh enabled');

			let lastModified = null;
			let checkInterval = null;

			// Function to check if page was modified
			async function checkForChanges() {
				try {
					const response = await fetch(location.href, {
						method: 'HEAD',
						cache: 'no-cache'
					});

					const currentModified = response.headers.get('last-modified');
					const currentEtag = response.headers.get('etag');

					// Use both last-modified and etag for better detection
					const pageSignature = currentModified + currentEtag;

					if (lastModified && lastModified !== pageSignature) {
						console.log('ğŸ”„ Page changed, refreshing...');
						location.reload();
					}

					lastModified = pageSignature;
				} catch (error) {
					// Silently handle errors (might be network issues)
				}
			}

			// Check every 2 seconds
			checkInterval = setInterval(checkForChanges, 2000);

			// Initial check after 1 second
			setTimeout(checkForChanges, 1000);

			// Cleanup when page unloads
			window.addEventListener('beforeunload', () => {
				if (checkInterval) {
					clearInterval(checkInterval);
				}
			});
		}
	</script>
</body>
</html>